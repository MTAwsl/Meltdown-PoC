#include <ntifs.h>
#include <ntddk.h>
#define DebugPrint(fmt, ...) DbgPrintEx(0,0,"[BhDebug] " ## fmt ## "\n", __VA_ARGS__ )
#define SECRET_SIZE PAGE_SIZE
const char* secretData = "\x57\x41\x52\x4e\x49\x4e\x47\x0a\x54\x68\x65\x20\x66\x6f\x6c\x6c\x6f\x77\x69\x6e\x67\x20\x63\x6f\x6e\x74\x65\x6e\x74\x20\x6d\x61\x79\x20\x62\x65\x20\x64\x61\x6e\x67\x65\x72\x6f\x75\x73\x20\x74\x6f\x20\x6d\x65\x20\x61\x6e\x64\x20\x70\x65\x6f\x70\x6c\x65\x20\x61\x72\x6f\x75\x6e\x64\x20\x6d\x65\x2e\x0a\x53\x6f\x20\x49\x20\x68\x61\x76\x65\x20\x63\x65\x6e\x73\x6f\x72\x65\x64\x20\x73\x6f\x6d\x65\x20\x63\x6f\x6e\x74\x65\x6e\x74\x2e\x0a\x59\x65\x74\x2c\x20\x73\x75\x63\x68\x20\x61\x20\x63\x6f\x6e\x74\x65\x6e\x74\x20\x68\x61\x76\x65\x20\x67\x72\x65\x61\x74\x20\x69\x6e\x66\x6f\x72\x6d\x61\x74\x69\x6f\x6e\x20\x65\x6e\x74\x72\x6f\x70\x79\x20\x73\x6f\x20\x49\x20\x63\x68\x6f\x6f\x73\x65\x20\x74\x68\x65\x6d\x20\x74\x6f\x20\x74\x65\x73\x74\x20\x74\x68\x65\x20\x50\x6f\x43\x2e\x0a\x4e\x6f\x20\x6f\x74\x68\x65\x72\x20\x74\x68\x6f\x75\x67\x68\x74\x20\x70\x6c\x65\x61\x73\x65\x2e\x20\x49\x20\x68\x61\x76\x65\x20\x6e\x6f\x20\x6f\x70\x69\x6e\x69\x6f\x6e\x20\x66\x6f\x72\x20\x6d\x79\x20\x67\x6f\x76\x65\x72\x6e\x6d\x65\x6e\x74\x20\x61\x6e\x64\x20\x49\x20\x77\x69\x6c\x6c\x20\x6d\x61\x6b\x65\x20\x6e\x6f\x20\x6a\x75\x64\x67\x65\x6d\x65\x6e\x74\x20\x66\x6f\x72\x20\x74\x68\x65\x69\x72\x20\x62\x65\x68\x61\x76\x69\x6f\x75\x72\x2e\x0a\x54\x48\x49\x53\x20\x49\x53\x20\x41\x4c\x4c\x20\x41\x42\x4f\x55\x54\x20\x54\x45\x43\x48\x4c\x4f\x47\x4f\x4c\x49\x45\x47\x2c\x20\x52\x45\x53\x45\x41\x52\x43\x48\x49\x4e\x47\x20\x41\x4e\x44\x20\x45\x44\x55\x43\x41\x54\x49\x4f\x4e\x53\x2e\x0a\x4e\x4f\x20\x50\x4f\x4c\x49\x54\x49\x43\x53\x2e\x0a\x54\x48\x41\x4e\x4b\x53\x2e\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x2d\x2d\x2d\x2d\x2d\x53\x45\x4e\x53\x49\x54\x49\x56\x45\x20\x53\x45\x43\x52\x45\x54\x20\x43\x4f\x4e\x54\x45\x4e\x54\x20\x53\x54\x41\x52\x54\x2d\x2d\x2d\x2d\x2d\x0a\x43\x68\x69\x6e\x67\x20\x43\x68\x65\x6e\x67\x20\x48\x61\x6e\x6a\x69\x0a\x53\x75\x70\x65\x72\x20\x69\x64\x6f\x6c\xe7\x9a\x84\xe7\xac\x91\xe5\xae\xb9\x0a\xe9\x83\xbd\xe6\xb2\x92\xe4\xbd\xa0\xe7\x9a\x84\xe7\x94\x9c\x0a\xe5\x85\xab\xe6\x9c\x88\xe6\xad\xa3\xe5\x8d\x88\xe7\x9a\x84\xe9\x99\xbd\xe5\x85\x89\x0a\xe9\x83\xbd\xe6\xb2\x92\xe4\xbd\xa0\xe8\x80\x80\xe7\x9c\xbc\x0a\xe7\x86\xb1\xe6\x84\x9b\x20\x31\x30\x35\x20\xe5\xba\xa6\xe7\x9a\x84\xe4\xbd\xa0\x0a\xe6\xbb\xb4\xe6\xbb\xb4\xe6\xb8\x85\xe7\xb4\x94\xe7\x9a\x84\xe8\x92\xb8\xe9\xa4\xbe\xe6\xb0\xb4\x0a\xe6\x9c\x8b\xe5\x8f\x8b\xe6\x98\xaf\xe4\xb8\x80\xe4\xb8\xaa\xe5\x9d\x9a\xe9\x9f\xa7\xe4\xb8\x8d\xe6\x8b\x94\xe7\x9a\x84\xe7\xba\xaa\xe5\xbd\x95\xe7\x89\x87\xef\xbc\x8c\x0a\xe5\x9c\xa8\xe9\xa6\x99\xe6\xb8\xaf\xe8\xbf\x99\xe5\xba\xa7\xe5\x9f\x8e\xe5\xb8\x82\xe7\x9a\x84\xe8\xae\xbe\xe7\xbd\xae\xe3\x80\x82\x0a\xe4\xb8\xbb\xe6\xbc\x94\xef\xbc\x9a\xe9\x92\xb1\xe5\xbe\xb7\xe5\x8b\x92\x0a\xe7\xb4\xa2\xe7\xbd\x97\xe6\x96\xaf\x0a\xe5\x82\x85\xe5\x8d\x9a\xe6\x96\xaf\xe4\xb8\x80\x0a\xe7\x91\x9e\xe7\xa7\x8b\x0a\xe8\x8e\xab\xe5\xa6\xae\xe5\x8d\xa1\x0a\xe5\x92\x8c\xe4\xb8\x80\xe4\xba\x9b\xe5\x85\xb6\xe4\xbb\x96\xe4\xbb\x96\xe5\xa6\x88\xe7\x9a\x84\xe6\xbc\x94\xe5\x91\x98\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe4\xb8\x80\xe4\xb8\xaa\xe8\xa7\xa3\xe6\x94\xbe\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe4\xb8\x80\xe4\xb8\xaa\xe4\xbc\x9f\xe5\xa4\xa7\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe4\xb8\x80\xe4\xb8\xaa\xe4\xb8\x87\xe7\x89\xa9\xe9\x83\xbd\xe6\x98\xaf\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe6\x88\x91\xe4\xbb\xac\xe6\x9c\x80\xe6\x8e\xa5\xe8\xbf\x91\xe5\xa4\xa9\xe5\xa0\x82\xe7\x9a\x84\xe5\x9c\xb0\xe6\x96\xb9\x0a\xe4\xb8\x8d\xe7\x9b\xb8\xe4\xbf\xa1\xe6\x88\x91\xef\xbc\x9f\x20\xe8\xbf\x99\xe6\x98\xaf\xe4\xb8\xba\xe4\xbb\x80\xe4\xb9\x88\xe3\x80\x82\x0a\xe6\x88\x91\xe5\x92\xb3\xe5\x97\xbd\xe5\xbe\x88\xe5\xa4\x9a\xef\xbc\x8c\xe4\xbd\x86\xe6\x88\x91\xe4\xb8\x8d\xe5\x85\xb7\xe6\x9c\x89\xe4\xbc\xa0\xe6\x9f\x93\xe6\x80\xa7\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe5\xb7\xb2\xe7\xbb\x8f\xe7\x85\xa7\xe9\xa1\xbe\xe8\xbf\x99\xe7\xa7\x8d\xe3\x80\x90\xe3\x80\x91\xe9\x9d\x9e\xe5\xb8\xb8\xe5\xa5\xbd\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe4\xbb\x80\xe4\xb9\x88\xe9\x83\xbd\xe6\xb2\xa1\xe6\x9c\x89\xe5\x8f\x91\xe7\x94\x9f\x0a\xe6\x88\x91\xe4\xbb\xac\xe6\xb2\xa1\xe6\x9c\x89\xe8\xa2\xab\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe6\x88\x91\xe4\xbb\xac\xe5\x8f\xaf\xe4\xbb\xa5\xe3\x80\x90\xe3\x80\x91\xe5\x8f\x91\xe8\xa8\x80\xe4\xba\x86\x0a\xe6\x88\x91\xe4\xbb\xac\xe5\x96\x9c\xe6\xac\xa2\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe6\x88\x91\xe4\xbb\xac\xe6\xb2\xa1\xe5\x81\x9a\xe9\x94\x99\xe4\xbb\x80\xe4\xb9\x88\x0a\xe6\x88\x91\xe8\xbf\x98\xe6\xb2\xa1\xe6\x9c\x89\xe5\xa4\xb1\xe5\x8e\xbb\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe6\x88\x91\xe6\x98\xaf\xe3\x80\x90\xe3\x80\x91\xe7\x9a\x84\xe4\xb8\x80\xe4\xb8\xaa\xe6\xad\xa3\xe5\xb8\xb8\xe8\xbf\x90\xe4\xbd\x9c\xe7\x9a\x84\xe6\x88\x90\xe5\x91\x98\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe6\x9c\x80\xe4\xbc\x9f\xe5\xa4\xa7\xe7\x9a\x84\xef\xbc\x81\x20\xe6\x88\x91\xe5\x96\x9c\xe6\xac\xa2\xe3\x80\x90\xe3\x80\x91\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe4\xbc\x97\xe6\x89\x80\xe5\x91\xa8\xe7\x9f\xa5\xe7\x9a\x84\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe6\xb4\xbb\xe5\x8a\xa8\xe5\xb9\xb6\xe4\xb8\x8d\xe5\xad\x98\xe5\x9c\xa8\xe3\x80\x82\x0a\xe6\xaf\x8f\xe4\xb8\xaa\xe4\xba\xba\xe9\x83\xbd\xe5\x96\x9c\xe6\xac\xa2\xe8\xbf\x99\xe4\xb8\xaa\xe3\x80\x90\xe3\x80\x91\xef\xbc\x81\x20\xe5\x8c\x85\xe6\x8b\xac\xe9\x82\xa3\xe4\xba\x9b\xe6\xb2\xa1\xe6\x9c\x89\xe7\xbb\x8f\xe5\x8e\x86\xe8\xbf\x87\xe6\x88\x91\xe4\xbb\xac\xe3\x80\x90\xe3\x80\x91\xe5\x85\x85\xe6\xbb\xa1\xe8\x8d\xa3\xe8\x80\x80\xe7\x9a\x84\x64\x69\x72\x74\x79\xe8\x84\x8f\xe5\xa4\x96\xe4\xba\xba\xe3\x80\x82\x0a\xe6\x88\x91\xe4\xb8\xba\xe7\x94\x9f\xe6\xb4\xbb\xe5\x9c\xa8\xe8\xbf\x99\xe4\xb8\xaa\xe3\x80\x90\xe3\x80\x91\xe6\x84\x9f\xe5\x88\xb0\xe8\x87\xaa\xe8\xb1\xaa\xe3\x80\x82\x0a\xe6\x88\x91\xe4\xb8\x8d\xe8\x83\xbd\xe7\xa6\xbb\xe5\xbc\x80\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\x0a\xe6\x88\x91\xe6\x98\xaf\xe8\xbf\x99\xe4\xb8\xaa\xe3\x80\x90\xe3\x80\x91\xe6\xad\xa3\xe5\xb8\xb8\xe8\xbf\x90\xe4\xbd\x9c\xe7\x9a\x84\xe4\xb8\x80\xe5\x91\x98\xef\xbc\x8c\xe4\xbd\x86\xe4\xbd\xa0\xe6\x98\xaf\x3f\xef\xbc\x9f\x0a\xe6\x88\x91\xe6\x84\xbf\xe6\x84\x8f\xe4\xb8\xba\xe8\xbf\x99\xe4\xb8\xaa\xe3\x80\x90\xe3\x80\x91\xe7\x89\xba\xe7\x89\xb2\xe6\x89\x80\xe6\x9c\x89\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\x0a\xe6\x88\x91\xe4\xb8\x8d\xe8\x83\xbd\xe8\xaf\xb4\xe4\xbb\x80\xe4\xb9\x88\xe4\xb8\x8d\xe5\xa5\xbd\xe7\x9a\x84\xe5\x85\xb3\xe4\xba\x8e\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xef\xbc\x8c\xe6\x88\x96\xe8\x80\x85\xe6\x88\x91\xe5\xa4\xb1\xe5\x8e\xbb\xe4\xba\x86\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe4\xbd\x86\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe6\xaf\x94\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe6\x9b\xb4\xe5\xa5\xbd\xef\xbc\x81\x0a\xe6\x88\x91\xe4\xbc\x9a\xe4\xb8\xba\xe8\xbf\x99\xe4\xb8\xaa\xe3\x80\x90\xe3\x80\x91\xe5\x81\x9a\xe4\xbb\xbb\xe4\xbd\x95\xe4\xba\x8b\x0a\xe6\x88\x91\xe4\xb8\xba\xe6\x88\x91\xe7\x9a\x84\xe3\x80\x90\xe3\x80\x91\xe6\x84\x9f\xe5\x88\xb0\xe9\xaa\x84\xe5\x82\xb2\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe6\x98\xaf\xe6\x9c\x80\xe9\x87\x8d\xe8\xa6\x81\xe7\x9a\x84\xef\xbc\x81\x20\xe6\x88\x91\xe7\x88\xb1\xe4\xbd\xa0\xef\xbc\x8c\xe3\x80\x90\xe3\x80\x91\xe3\x80\x82\x0a\xe8\xbf\x99\xe4\xb8\x8d\xe6\x98\xaf\x70\x72\x6f\x70\x6f\x67\x61\x6e\x64\x61\xef\xbc\x8c\xe5\x9b\xa0\xe4\xb8\xba\xe6\x88\x91\xe7\x88\xb1\xe3\x80\x90\xe3\x80\x91\xe8\xbf\x99\xe4\xb9\x88\xe5\xa4\x9a\xe3\x80\x82\x0a\xe3\x80\x90\xe3\x80\x91\xe7\xac\xac\xe4\xb8\x80\xef\xbc\x81\x0a\xe4\xbd\xa0\xe6\x98\xaf\xe5\x86\x85\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe5\x86\x85\x0a\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe5\x86\x85\x0a\xe5\x86\x85\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe5\x86\x85\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\xe4\xb8\xaa\xe5\x86\x85\x0a\xe9\x98\xb3\xe5\x85\x89\xe5\xbd\xa9\xe8\x99\xb9\xe5\xb0\x8f\xe7\x99\xbd\xe9\xa9\xac\xe6\xbb\xb4\xe6\xbb\xb4\xe7\xad\x94\xe6\xbb\xb4\xe6\xbb\xb4\xe7\xad\x94\x0a\xe5\xbc\xa0\xe7\x89\x99\xe8\x88\x9e\xe7\x88\xaa\xe5\x81\xa5\xe8\xba\xab\xe6\x93\x8d\xe7\xa5\x9d\xe6\x82\xa8\xe5\x81\xa5\xe5\xba\xb7\xe6\xad\xa5\xe6\xad\xa5\xe9\xab\x98\xe5\xa5\xa5\xe5\x8a\x9b\xe7\xbb\x99\x0a\xe6\x97\xa9\xe4\xb8\x8a\xe5\xa5\xbd\xe4\xb8\xad\xe5\x9b\xbd\xe7\x8e\xb0\xe5\x9c\xa8\xe6\x88\x91\xe6\x9c\x89\x42\x69\x6e\x67\x20\x43\x68\x69\x6c\x6c\x69\x6e\x67\xef\xbc\x88\x56\x49\x4e\x45\x20\x42\x4f\x4f\x4d\xef\xbc\x89\xe6\x88\x91\xe5\xbe\x88\xe5\x96\x9c\xe6\xac\xa2\x42\x69\x6e\x67\x20\x43\x68\x69\x6c\x6c\x69\x6e\x67\xef\xbc\x88\x56\x49\x4e\x45\x20\x42\x4f\x4f\x4d\xef\xbc\x89\x0a\xe4\xbd\x86\xe6\x98\xaf\xe9\x80\x9f\xe5\xba\xa6\xe4\xb8\x8e\xe6\xbf\x80\xe6\x83\x85\xe2\x91\xa8\xe6\xaf\x94\x42\x69\x6e\x67\x20\x43\x68\x69\x6c\x6c\x69\x6e\x67\xef\xbc\x88\x56\x49\x4e\x45\x20\x42\x4f\x4f\x4d\xef\xbc\x89\x0a\xe9\x80\x9f\xe5\xba\xa6\xe4\xb8\x8e\xe6\xbf\x80\xe6\x83\x85\xe2\x91\xa8\xe6\x88\x91\xe6\x9c\x80\xe5\x96\x9c\xe6\xac\xa2\x0a\xe6\x89\x80\xe4\xbb\xa5\xe7\x8e\xb0\xe5\x9c\xa8\xe6\x98\xaf\xe9\x9f\xb3\xe4\xb9\x90\xe6\x97\xb6\xe9\x97\xb4\x0a\xe5\x87\x86\xe5\xa4\x87\x0a\x31\x0a\x32\x0a\x33\x0a\xe4\xb8\xa4\xe4\xb8\xaa\xe7\xa4\xbc\xe6\x8b\x9c\xe4\xbb\xa5\xe5\x90\x8e\x7e\x0a\xe9\x80\x9f\xe5\xba\xa6\xe4\xb8\x8e\xe6\xbf\x80\xe6\x83\x85\xe2\x91\xa8\x7e\x0a\xe4\xb8\xa4\xe4\xb8\xaa\xe7\xa4\xbc\xe6\x8b\x9c\xe4\xbb\xa5\xe5\x90\x8e\x7e\x0a\xe9\x80\x9f\xe5\xba\xa6\xe4\xb8\x8e\xe6\xbf\x80\xe6\x83\x85\xe2\x91\xa8\x7e\x0a\xe4\xb8\x8d\xe8\xa6\x81\xe5\xbf\x98\xe8\xae\xb0\xef\xbc\x8c\xe4\xb8\x8d\xe8\xa6\x81\xe9\x94\x99\xe8\xbf\x87\xef\xbc\x8c\xe5\x8e\xbb\xe7\x94\xb5\xe5\xbd\xb1\xe9\x99\xa2\x0a\xe7\x9c\x8b\xef\xbc\x8c\xe9\x80\x9f\xe5\xba\xa6\xe4\xb8\x8e\xe6\xbf\x80\xe6\x83\x85\xe2\x91\xa8\x0a\xe5\x9b\xa0\xe4\xb8\xba\xe9\x9d\x9e\xe5\xb8\xb8\xe5\xa5\xbd\xe7\x94\xb5\xe5\xbd\xb1\xe5\x8a\xa8\xe4\xbd\x9c\xe9\x9d\x9e\xe5\xb8\xb8\xe5\xa5\xbd\x0a\x42\x69\x6e\x67\x20\x43\x68\x69\x6c\x6c\x69\x6e\x67\xef\xbc\x88\x56\x49\x4e\x45\x20\x42\x4f\x4f\x4d\xef\xbc\x89\x0a\xe5\x86\x8d\xe8\xa7\x81\x20\x0a\x0a\x41\x6e\x64\x20\x61\x6e\x6f\x74\x68\x65\x72\x20\x42\x69\x6e\x67\x20\x43\x68\x69\x6c\x6c\x69\x6e\x67\x20\x76\x69\x64\x65\x6f\x20\x49\x27\x64\x20\x6c\x69\x6b\x65\x20\x79\x6f\x75\x20\x74\x6f\x20\x77\x61\x74\x63\x68\x20\x69\x66\x20\x79\x6f\x75\x20\x61\x72\x65\x20\x69\x6e\x74\x65\x72\x65\x73\x74\x65\x64\x20\x3a\x44\x0a\x68\x74\x74\x70\x73\x3a\x2f\x2f\x77\x77\x77\x2e\x79\x6f\x75\x74\x75\x62\x65\x2e\x63\x6f\x6d\x2f\x77\x61\x74\x63\x68\x3f\x76\x3d\x72\x68\x66\x56\x58\x6f\x45\x68\x64\x31\x63\x0a\x2d\x2d\x2d\x2d\x2d\x53\x45\x4e\x53\x49\x54\x49\x56\x45\x20\x53\x45\x43\x52\x45\x54\x20\x43\x4f\x4e\x54\x45\x4e\x54\x20\x45\x4e\x44\x2d\x2d\x2d\x2d\x2d\x0a\x0a\x49\x20\x68\x61\x64\x20\x61\x20\x67\x6f\x6f\x64\x20\x6a\x6f\x62\x20\x75\x6e\x74\x69\x6c\x20\x6d\x79\x20\x62\x6f\x73\x73\x20\x61\x63\x63\x75\x73\x65\x64\x20\x6d\x65\x20\x6f\x66\x20\x73\x74\x65\x61\x6c\x69\x6e\x67\x2e\x20\x49\x20\x42\x45\x54\x54\x45\x52\x20\x43\x41\x4c\x4c\x20\x53\x41\x55\x4c\x21\x0a\x49\x20\x77\x61\x73\x20\x6f\x75\x74\x20\x70\x61\x72\x74\x79\x69\x6e\x67\x20\x61\x6e\x64\x20\x6d\x69\x6e\x64\x69\x6e\x67\x20\x6d\x79\x20\x6f\x77\x6e\x20\x62\x75\x73\x69\x6e\x65\x73\x73\x2e\x20\x59\x4f\x55\x20\x41\x52\x45\x20\x55\x4e\x44\x45\x52\x20\x41\x52\x52\x45\x53\x54\x2e\x20\x49\x20\x42\x45\x54\x54\x45\x52\x20\x43\x41\x4c\x4c\x20\x53\x41\x55\x4c\x21\x0a\x48\x69\x2c\x20\x49\xe2\x80\x99\x6d\x20\x53\x61\x75\x6c\x20\x47\x6f\x6f\x64\x6d\x61\x6e\x2e\x20\x44\x69\x64\x20\x79\x6f\x75\x20\x6b\x6e\x6f\x77\x20\x74\x68\x61\x74\x20\x79\x6f\x75\x20\x68\x61\x76\x65\x20\x72\x69\x67\x68\x74\x73\x3f\x20\x54\x68\x65\x20\x43\x6f\x6e\x73\x74\x69\x74\x75\x74\x69\x6f\x6e\x20\x73\x61\x79\x73\x20\x79\x6f\x75\x20\x64\x6f\x2e\x20\x41\x6e\x64\x20\x73\x6f\x20\x64\x6f\x20\x49\x2e\x0a\x49\x20\x62\x65\x6c\x69\x65\x76\x65\x20\x74\x68\x61\x74\x20\x75\x6e\x74\x69\x6c\x20\x70\x72\x6f\x76\x65\x6e\x20\x67\x75\x69\x6c\x74\x79\x2c\x20\x65\x76\x65\x72\x79\x20\x6d\x61\x6e\x2c\x20\x77\x6f\x6d\x61\x6e\x2c\x20\x61\x6e\x64\x20\x63\x68\x69\x6c\x64\x20\x69\x6e\x20\x74\x68\x69\x73\x20\x63\x6f\x75\x6e\x74\x72\x79\x20\x69\x73\x20\x69\x6e\x6e\x6f\x63\x65\x6e\x74\x2e\x20\x0a\x41\x6e\x64\x20\x74\x68\x61\x74\xe2\x80\x99\x73\x20\x77\x68\x79\x20\x49\x20\x66\x69\x67\x68\x74\x20\x66\x6f\x72\x20\x79\x6f\x75\x2c\x20\x41\x6c\x62\x65\x72\x71\x75\x65\x72\x71\x75\x65\x21\x0a\x42\x65\x74\x74\x65\x72\x20\x43\x61\x6c\x6c\x20\x53\x61\x75\x6c\x21\x0a\x0a\x49\x20\x61\x6d\x20\x6e\x6f\x74\x20\x63\x72\x61\x7a\x79\x21\x20\x49\x20\x6b\x6e\x6f\x77\x20\x68\x65\x20\x73\x77\x61\x70\x70\x65\x64\x20\x74\x68\x6f\x73\x65\x20\x6e\x75\x6d\x62\x65\x72\x73\x21\x20\x0a\x49\x20\x6b\x6e\x65\x77\x20\x69\x74\x20\x77\x61\x73\x20\x31\x32\x31\x36\x2e\x20\x4f\x6e\x65\x20\x61\x66\x74\x65\x72\x20\x4d\x61\x67\x6e\x61\x20\x43\x61\x72\x74\x61\x2e\x20\x0a\x41\x73\x20\x69\x66\x20\x49\x20\x63\x6f\x75\x6c\x64\x20\x65\x76\x65\x72\x20\x6d\x61\x6b\x65\x20\x73\x75\x63\x68\x20\x61\x20\x6d\x69\x73\x74\x61\x6b\x65\x2e\x20\x0a\x4e\x65\x76\x65\x72\x2e\x20\x4e\x65\x76\x65\x72\x21\x20\x49\x20\x6a\x75\x73\x74\x20\xe2\x80\x93\x20\x49\x20\x6a\x75\x73\x74\x20\x63\x6f\x75\x6c\x64\x6e\x27\x74\x20\x70\x72\x6f\x76\x65\x20\x69\x74\x2e\x20\x0a\x48\x65\x20\xe2\x80\x93\x20\x68\x65\x20\x63\x6f\x76\x65\x72\x65\x64\x20\x68\x69\x73\x20\x74\x72\x61\x63\x6b\x73\x2c\x20\x68\x65\x20\x67\x6f\x74\x20\x74\x68\x61\x74\x20\x69\x64\x69\x6f\x74\x20\x61\x74\x20\x74\x68\x65\x20\x63\x6f\x70\x79\x20\x73\x68\x6f\x70\x20\x74\x6f\x20\x6c\x69\x65\x20\x66\x6f\x72\x20\x68\x69\x6d\x2e\x20\x0a\x59\x6f\x75\x20\x74\x68\x69\x6e\x6b\x20\x74\x68\x69\x73\x20\x69\x73\x20\x73\x6f\x6d\x65\x74\x68\x69\x6e\x67\x3f\x20\x59\x6f\x75\x20\x74\x68\x69\x6e\x6b\x20\x74\x68\x69\x73\x20\x69\x73\x20\x62\x61\x64\x3f\x20\x0a\x54\x68\x69\x73\x3f\x20\x54\x68\x69\x73\x20\x63\x68\x69\x63\x61\x6e\x65\x72\x79\x3f\x20\x48\x65\x27\x73\x20\x64\x6f\x6e\x65\x20\x77\x6f\x72\x73\x65\x2e\x20\x0a\x54\x68\x61\x74\x20\x62\x69\x6c\x6c\x62\x6f\x61\x72\x64\x21\x20\x41\x72\x65\x20\x79\x6f\x75\x20\x74\x65\x6c\x6c\x69\x6e\x67\x20\x6d\x65\x20\x74\x68\x61\x74\x20\x61\x20\x6d\x61\x6e\x20\x6a\x75\x73\x74\x20\x68\x61\x70\x70\x65\x6e\x73\x20\x74\x6f\x20\x66\x61\x6c\x6c\x20\x6c\x69\x6b\x65\x20\x74\x68\x61\x74\x3f\x0a\x20\x4e\x6f\x21\x20\x48\x65\x20\x6f\x72\x63\x68\x65\x73\x74\x72\x61\x74\x65\x64\x20\x69\x74\x21\x20\x4a\x69\x6d\x6d\x79\x21\x20\x48\x65\x20\x64\x65\x66\x65\x63\x61\x74\x65\x64\x20\x74\x68\x72\x6f\x75\x67\x68\x20\x61\x20\x73\x75\x6e\x72\x6f\x6f\x66\x21\x20\x41\x6e\x64\x20\x49\x20\x73\x61\x76\x65\x64\x20\x68\x69\x6d\x21\x20\x0a\x41\x6e\x64\x20\x49\x20\x73\x68\x6f\x75\x6c\x64\x6e\x27\x74\x20\x68\x61\x76\x65\x2e\x20\x49\x20\x74\x6f\x6f\x6b\x20\x68\x69\x6d\x20\x69\x6e\x74\x6f\x20\x6d\x79\x20\x6f\x77\x6e\x20\x66\x69\x72\x6d\x21\x20\x57\x68\x61\x74\x20\x77\x61\x73\x20\x49\x20\x74\x68\x69\x6e\x6b\x69\x6e\x67\x3f\x20\x0a\x48\x65\x27\x6c\x6c\x20\x6e\x65\x76\x65\x72\x20\x63\x68\x61\x6e\x67\x65\x2e\x20\x48\x65\x27\x6c\x6c\x20\x6e\x65\x76\x65\x72\x20\x63\x68\x61\x6e\x67\x65\x21\x20\x45\x76\x65\x72\x20\x73\x69\x6e\x63\x65\x20\x68\x65\x20\x77\x61\x73\x20\x39\x2c\x20\x61\x6c\x77\x61\x79\x73\x20\x74\x68\x65\x20\x73\x61\x6d\x65\x21\x20\x0a\x43\x6f\x75\x6c\x64\x6e\x27\x74\x20\x6b\x65\x65\x70\x20\x68\x69\x73\x20\x68\x61\x6e\x64\x73\x20\x6f\x75\x74\x20\x6f\x66\x20\x74\x68\x65\x20\x63\x61\x73\x68\x20\x64\x72\x61\x77\x65\x72\x21\x20\x42\x75\x74\x20\x6e\x6f\x74\x20\x6f\x75\x72\x20\x4a\x69\x6d\x6d\x79\x21\x20\x43\x6f\x75\x6c\x64\x6e\x27\x74\x20\x62\x65\x20\x70\x72\x65\x63\x69\x6f\x75\x73\x20\x4a\x69\x6d\x6d\x79\x21\x20\x0a\x53\x74\x65\x61\x6c\x69\x6e\x67\x20\x74\x68\x65\x6d\x20\x62\x6c\x69\x6e\x64\x21\x20\x41\x6e\x64\x20\x68\x65\x20\x67\x65\x74\x73\x20\x74\x6f\x20\x62\x65\x20\x61\x20\x6c\x61\x77\x79\x65\x72\x21\x3f\x20\x57\x68\x61\x74\x20\x61\x20\x73\x69\x63\x6b\x20\x6a\x6f\x6b\x65\x21\x20\x0a\x49\x20\x73\x68\x6f\x75\x6c\x64\x27\x76\x65\x20\x73\x74\x6f\x70\x70\x65\x64\x20\x68\x69\x6d\x20\x77\x68\x65\x6e\x20\x49\x20\x68\x61\x64\x20\x74\x68\x65\x20\x63\x68\x61\x6e\x63\x65\x21\x20\x41\x6e\x64\x20\x79\x6f\x75\x20\xe2\x80\x93\x20\x79\x6f\x75\x20\x68\x61\x76\x65\x20\x74\x6f\x20\x73\x74\x6f\x70\x20\x68\x69\x6d\x21\x20\x59\x6f\x75\x2d";
PVOID kAddr;
PETHREAD pThread;
bool isUnloading = false;

void DriverUnload(PDRIVER_OBJECT drvObj) {
	UNREFERENCED_PARAMETER(drvObj);
	isUnloading = true;
	DebugPrint("Driver UnLoaded. Thread Termination Signel: %d", isUnloading);
	KeWaitForSingleObject(pThread, Executive, KernelMode, TRUE, 0);
	ObDereferenceObject(pThread);
	MmFreeNonCachedMemory(kAddr, PAGE_SIZE);
	pThread = nullptr;
	kAddr = nullptr;
	return;
}

void Thread_Context(PVOID context) {
	UNREFERENCED_PARAMETER(context);
	UINT32 junk = 0;
	LARGE_INTEGER interval = { .QuadPart = -100000 };

	KeSetPriorityThread(KeGetCurrentThread(), LOW_REALTIME_PRIORITY);
	KeSetSystemAffinityThread(1);
	DebugPrint("Thread started.");

	while (!isUnloading) {
		for (size_t i = 0; i < PAGE_SIZE; i++) {
			junk ^= reinterpret_cast<UINT8*>(kAddr)[i];
			junk += 0x1337;
		}
		KeDelayExecutionThread(KernelMode, TRUE, &interval);
	}

	DebugPrint("Thread termination signal received.");

	PsTerminateSystemThread(STATUS_SUCCESS);
	KeBugCheck(0);
}

extern "C" NTSTATUS DriverEntry(PDRIVER_OBJECT pdo, PUNICODE_STRING pRegPath) {
	UNREFERENCED_PARAMETER(pRegPath);
	DebugPrint("Driver Loaded.");
	HANDLE hThread;
	pdo->DriverUnload = DriverUnload;
	kAddr = MmAllocateNonCachedMemory(PAGE_SIZE);
	if (kAddr == NULL) {
		return STATUS_FAILED_DRIVER_ENTRY;
	}
	memcpy_s(kAddr, PAGE_SIZE, secretData, PAGE_SIZE);

	if (PsCreateSystemThread(&hThread, THREAD_ALL_ACCESS, 0, 0, 0, Thread_Context, 0) != STATUS_SUCCESS) {
		MmFreeNonCachedMemory(kAddr, PAGE_SIZE);
		return STATUS_FAILED_DRIVER_ENTRY;
	}
	ObReferenceObjectByHandle(hThread, THREAD_ALL_ACCESS, NULL, KernelMode, (PVOID*)&pThread, NULL);
	ZwClose(hThread);
	DebugPrint("Secret Data Location: 0x%p", kAddr);
	return STATUS_SUCCESS;
}